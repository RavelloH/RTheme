/* Tiptap Editor Styles */

.tiptap,
.md-content {
  @apply min-h-full text-secondary-foreground;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* Block 文字样式（不含布局样式，如 margin/padding/line-height） */
.processed-text-content {
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* 移除 ProseMirror 聚焦时的默认边框 */
.ProseMirror-focused {
  outline: none !important;
  border: none !important;
}

.tiptap:focus,
.tiptap:focus-visible {
  outline: none !important;
  border: none !important;
}

.mini-md-content {
  @apply min-h-auto;
}

/* Text Alignment */
.tiptap [style*="text-align: left"],
.md-content [style*="text-align: left"] {
  text-align: left;
}

.tiptap [style*="text-align: center"],
.md-content [style*="text-align: center"] {
  text-align: center;
}

.tiptap [style*="text-align: right"],
.md-content [style*="text-align: right"] {
  text-align: right;
}

.tiptap p,
.md-content p {
  @apply my-4 leading-relaxed text-xl md:text-base;
}

.mini-md-content {
  @apply my-0 text-base;
}

.tiptap blockquote p,
.md-content blockquote p {
  @apply my-1;
}
/* Placeholder */
.tiptap p.is-editor-empty:first-child::before,
.md-content p.is-editor-empty:first-child::before {
  @apply text-foreground/30 float-left h-0 pointer-events-none;
  content: attr(data-placeholder);
}

/* Task List - Tiptap */
.tiptap ul[data-type="taskList"],
.md-content ul[data-type="taskList"] {
  @apply list-none pl-0;
}

.tiptap ul[data-type="taskList"] li,
.md-content ul[data-type="taskList"] li {
  @apply flex items-center gap-2;
}

.tiptap ul[data-type="taskList"] li > label,
.md-content ul[data-type="taskList"] li > label {
  @apply flex items-center gap-2 cursor-pointer;
}

.tiptap ul[data-type="taskList"] li > div,
.md-content ul[data-type="taskList"] li > div {
  @apply flex-1;
}

.tiptap ul[data-type="taskList"] li > div > p,
.md-content ul[data-type="taskList"] li > div > p {
  @apply my-0 text-base;
}

/* Task List - react-markdown (remark-gfm) */
.md-content .contains-task-list {
  @apply list-none pl-0;
}

.md-content .task-list-item {
  @apply flex items-center gap-2;
}

/* Task List Checkbox - 匹配项目 Checkbox 组件样式 */
.tiptap ul[data-type="taskList"] input[type="checkbox"],
.md-content ul[data-type="taskList"] input[type="checkbox"],
.md-content .task-list-item input[type="checkbox"] {
  @apply appearance-none w-4 h-4 bg-background border-2 border-foreground rounded-none
         cursor-pointer flex-none transition-colors duration-200
         hover:border-primary/50
         checked:border-primary
         relative m-0;
}

/* Task List Checkbox - 对勾标记 */
.tiptap ul[data-type="taskList"] input[type="checkbox"]::after,
.md-content ul[data-type="taskList"] input[type="checkbox"]::after,
.md-content .task-list-item input[type="checkbox"]::after {
  content: "";
  position: absolute;
  display: none;
  left: 50%;
  top: 50%;
  width: 0.25rem;
  height: 0.5rem;
  border: solid var(--color-primary);
  border-width: 0 2.5px 2.5px 0;
  transform: translate(-50%, -60%) rotate(45deg);
}

.tiptap ul[data-type="taskList"] input[type="checkbox"]:checked::after,
.md-content ul[data-type="taskList"] input[type="checkbox"]:checked::after,
.md-content .task-list-item input[type="checkbox"]:checked::after {
  display: block;
}

/* Blockquote */
.tiptap blockquote,
.md-content blockquote {
  @apply border-l-4 border-foreground pl-4 ml-0 opacity-80 py-2 my-4 bg-muted/50;
}

/* Code */
/* 行内代码样式 - 不在 pre 内的 code */
.tiptap :not(pre) > code,
.md-content :not(pre) > code {
  @apply bg-foreground/10 text-foreground px-1 py-0.5 mx-1 rounded-xs text-lg md:text-sm font-mono hover:bg-foreground/20 transition-all;
}

/* 代码块基础样式 */
.tiptap pre,
.md-content pre {
  @apply rounded-lg overflow-hidden my-4;
  max-width: 100%;
  overflow-x: auto;
}

/* Shiki 代码块样式 */
.tiptap pre.shiki,
.md-content pre.shiki {
  @apply p-4 overflow-x-auto;
}

.tiptap pre.shiki code,
.md-content pre.shiki code {
  @apply bg-transparent p-0 font-mono text-lg md:text-sm leading-relaxed;
}

/* 普通代码块样式（回退） */
.tiptap pre:not(.shiki),
.md-content pre:not(.shiki) {
  @apply bg-foreground/10 text-foreground p-4;
}

.tiptap pre:not(.shiki) code,
.md-content pre:not(.shiki) code {
  @apply bg-transparent p-0 font-mono text-lg md:text-sm;
}

/* Headings */
.tiptap h1,
.tiptap h2,
.tiptap h3,
.tiptap h4,
.tiptap h5,
.tiptap h6,
.md-content h1,
.md-content h2,
.md-content h3,
.md-content h4,
.md-content h5,
.md-content h6 {
  @apply font-bold mt-6 mb-3 leading-tight text-foreground scroll-mt-20;
}

/* 首个标题去除上边距 */
.tiptap h1:first-child,
.tiptap h2:first-child,
.tiptap h3:first-child,
.tiptap h4:first-child,
.tiptap h5:first-child,
.tiptap h6:first-child,
.md-content h1:first-child,
.md-content h2:first-child,
.md-content h3:first-child,
.md-content h4:first-child,
.md-content h5:first-child,
.md-content h6:first-child {
  @apply mt-0;
}

.tiptap h1,
.md-content h1 {
  @apply text-6xl md:text-4xl border-b-2 pb-2 border-border mt-8 mb-4;
}
.tiptap h2,
.md-content h2 {
  @apply text-5xl md:text-3xl;
}
.tiptap h3,
.md-content h3 {
  @apply text-4xl md:text-2xl mt-4 mb-2;
}
.tiptap h4,
.md-content h4 {
  @apply text-3xl md:text-xl mt-3 mb-2;
}
.tiptap h5,
.md-content h5 {
  @apply text-2xl md:text-lg mt-2 mb-1;
}
.tiptap h6,
.md-content h6 {
  @apply text-xl mt-2 mb-1 md:text-base;
}

/* Images */
.tiptap img,
.md-content img {
  @apply block max-w-full max-h-[80vh] w-auto h-auto rounded-lg mx-auto mt-4 mb-1;
  object-fit: contain;
}

.mini-md-content img {
  @apply max-h-[10em] ml-0 w-auto;
}

/* Horizontal Rule */
.tiptap hr,
.md-content hr {
  @apply border-t border-foreground/20 my-8;
}

/* Links */
.tiptap a,
.md-content a {
  @apply text-primary cursor-pointer;
}

/* Tables */
.tiptap table,
.md-content table {
  @apply border-collapse w-full my-4 text-base border border-border;
}

/* 表头样式 - 与 Table 组件保持一致 */
.tiptap thead,
.md-content thead {
  @apply border-b-2 border-muted bg-foreground/5;
}

.tiptap th,
.md-content th {
  @apply px-4 py-3 font-semibold text-muted-foreground text-left border-r border-border last:border-r-0;
}

/* 表格单元格样式 - 与 Table 组件保持一致 */
.tiptap td,
.md-content td {
  @apply px-4 py-3 text-left border-t border-border border-r last:border-r-0;
}

/* 表格行 hover 效果 */
.tiptap tbody tr,
.md-content tbody tr {
  @apply hover:bg-muted/50 transition-colors duration-200 ease-out;
}

/* Lists */
.tiptap li > p,
.md-content li > p {
  @apply m-0;
}

.tiptap ul,
.tiptap ol,
.md-content ul,
.md-content ol {
  @apply pl-6 text-xl md:text-base;
}

/* Unordered List - Multi-level styling */
.tiptap ul,
.md-content ul {
  list-style-type: disc;
}

.tiptap :is(ul) :is(ul),
.md-content :is(ul) :is(ul) {
  list-style-type: circle;
}

.tiptap :is(ul) :is(ul) :is(ul),
.md-content :is(ul) :is(ul) :is(ul) {
  list-style-type: square;
}

.tiptap ol,
.md-content ol {
  @apply list-decimal;
}

/* Highlight */
.tiptap mark,
.md-content mark {
  @apply bg-primary font-semibold text-primary-foreground rounded-[2px] mx-1 px-1;
}

/* Strikethrough */
.tiptap s,
.tiptap del,
.md-content s,
.md-content del {
  @apply line-through text-muted-foreground;
}

/* Underline */
.tiptap u,
.md-content u {
  @apply underline;
}

/* Subscript and Superscript */
.tiptap sub,
.md-content sub {
  @apply text-xs align-sub;
}

.tiptap sup,
.md-content sup {
  @apply text-xs align-super;
}

/* Bold */
.tiptap strong,
.md-content strong {
  @apply font-bold text-foreground;
}

/* Shiki 代码块暗黑模式支持 */
/* 支持系统偏好设置的暗黑模式 */
@media (prefers-color-scheme: dark) {
  .tiptap .shiki,
  .tiptap .shiki span,
  .md-content .shiki,
  .md-content .shiki span {
    color: var(--shiki-dark) !important;
    background-color: var(--shiki-dark-bg) !important;
  }
}

/* 支持 data-theme 属性切换 */
[data-theme="dark"] .tiptap .shiki,
[data-theme="dark"] .tiptap .shiki span,
[data-theme="dark"] .md-content .shiki,
[data-theme="dark"] .md-content .shiki span {
  color: var(--shiki-dark) !important;
  background-color: var(--shiki-dark-bg) !important;
}

/* 支持基于 Class 的暗黑模式切换 */
html.dark .tiptap .shiki,
html.dark .tiptap .shiki span,
html.dark .md-content .shiki,
html.dark .md-content .shiki span {
  color: var(--shiki-dark) !important;
  background-color: var(--shiki-dark-bg) !important;
}

.dark .tiptap .shiki,
.dark .tiptap .shiki span,
.dark .md-content .shiki,
.dark .md-content .shiki span {
  color: var(--shiki-dark) !important;
  background-color: var(--shiki-dark-bg) !important;
}

/* ========== Mathematics/LaTeX Styles ========== */

/* 数学公式渲染节点 - 基础样式 */
.tiptap-mathematics-render,
.md-content .katex-display,
.md-content .katex {
  @apply my-4 px-2 max-w-full;

  transition: all 0.2s ease;
}

.katex-display .katex {
  @apply w-full;
}

/* 可编辑的数学公式节点 - 悬停效果 */
.tiptap-mathematics-render--editable:hover {
  @apply bg-primary/10;
  border-radius: 4px;
  cursor: pointer;
  outline-offset: 2px;
}

/* 块级数学公式 - 居中显示 */
.tiptap-mathematics-render[data-type="block-math"],
.md-content .katex-display {
  @apply flex justify-center w-full;
  padding: 1rem 0;
  margin: 1.5rem 0;
}

/* 块级数学公式 - 内部  */
.tiptap-mathematics-render[data-type="block-math"] .block-math-inner,
.md-content .katex-display .block-math-inner {
  @apply w-full;
}

/* 行内数学公式 */
.tiptap-mathematics-render[data-type="inline-math"],
.md-content .katex {
  @apply inline-block align-middle;
  margin: 0 0.2em;
}

/* KaTeX 自身样式调整 */
.tiptap .katex,
.md-content .katex {
  font-size: 1.1em;
}

/* 块级公式的 KaTeX 容器 */
.tiptap .katex-display,
.md-content .katex-display {
  @apply w-full px-2;
  margin: 0;
  overflow-x: auto;
  overflow-y: hidden;
}

.tiptap-mathematics-render--editable:hover::after {
  @apply block;
  opacity: 1;
  transform: translateY(0);
}

/* 暗色模式下的样式调整 */
.dark .tiptap-mathematics-render--editable:hover {
  @apply bg-primary/20;
}

/* KaTeX 字体加载优化 */
.katex {
  font-family: "KaTeX_Main", "Times New Roman", serif;
}

/* 移除块级公式的滚动条样式（美化） */
.katex-display::-webkit-scrollbar {
  height: 6px;
}

.katex-display::-webkit-scrollbar-track {
  @apply bg-transparent;
}

.katex-display::-webkit-scrollbar-thumb {
  @apply bg-foreground/20 rounded;
}

.katex-display::-webkit-scrollbar-thumb:hover {
  @apply bg-foreground/30;
}

/* ========== Table Cell Selection Styles ========== */

/* ProseMirror 选中的节点样式 */
.tiptap .ProseMirror-selectednode {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

/* 表格单元格选择样式 */
.tiptap .selectedCell {
  @apply bg-primary/20 relative text-foreground;
}

.tiptap .selectedCell::after {
  opacity: 0.3;
  content: "";
  position: absolute;
  inset: 0;
  background-color: var(--color-primary);
  pointer-events: none;
  z-index: 1;
}

/* ========== Block Text-Only Styles ========== */
/* 仅文字样式，不含布局样式（margin/padding/line-height 等） */

/* 标题 - 只有字体大小和颜色，没有间距 */
.processed-text-content h1,
.processed-text-content h2,
.processed-text-content h3,
.processed-text-content h4,
.processed-text-content h5,
.processed-text-content h6 {
  @apply font-bold text-foreground;
}

.processed-text-content h1 {
  @apply text-6xl md:text-4xl;
}
.processed-text-content h2 {
  @apply text-5xl md:text-3xl;
}
.processed-text-content h3 {
  @apply text-4xl md:text-2xl;
}
.processed-text-content h4 {
  @apply text-3xl md:text-xl;
}
.processed-text-content h5 {
  @apply text-2xl md:text-lg;
}
.processed-text-content h6 {
  @apply text-xl md:text-base;
}

/* 粗体 */
.processed-text-content strong {
  @apply font-bold text-foreground;
}

/* 斜体（通过 em 标签） */
.processed-text-content em {
  @apply italic;
}

/* 代码 - 行内代码样式 */
.processed-text-content :not(pre) > code {
  @apply bg-foreground/10 text-foreground px-1 py-0.5 rounded-xs font-mono text-lg md:text-sm;
}

/* 代码块基础样式 */
.processed-text-content pre {
  @apply rounded-lg overflow-hidden max-w-full overflow-x-auto;
}

.processed-text-content pre code {
  @apply font-mono text-lg md:text-sm;
}

.processed-text-content pre:not(.shiki) {
  @apply bg-foreground/10 text-foreground p-4;
}

.processed-text-content pre:not(.shiki) code {
  @apply bg-transparent p-0;
}

/* 链接 */
.processed-text-content a {
  @apply text-primary cursor-pointer;
}

/* 列表 - 只保留列表符号样式，不保留 padding */
.processed-text-content ul {
  list-style-type: disc;
}
.processed-text-content :is(ul) :is(ul) {
  list-style-type: circle;
}
.processed-text-content :is(ul) :is(ul) :is(ul) {
  list-style-type: square;
}
.processed-text-content ol {
  @apply list-decimal;
}

/* 列表项内的段落无额外样式 */
.processed-text-content li > p {
  @apply m-0;
}

/* 高亮 */
.processed-text-content mark {
  @apply bg-primary font-semibold text-primary-foreground rounded-[2px] px-1;
}

/* 删除线 */
.processed-text-content s,
.processed-text-content del {
  @apply line-through text-muted-foreground;
}

/* 下划线 */
.processed-text-content u {
  @apply underline;
}

/* 上下标 */
.processed-text-content sub {
  @apply text-xs align-sub;
}
.processed-text-content sup {
  @apply text-xs align-super;
}

/* 表格 - 只保留基础样式，间距由外层控制 */
.processed-text-content table {
  @apply border-collapse w-full border border-border text-base;
}
.processed-text-content thead {
  @apply border-b-2 border-muted bg-foreground/5;
}
.processed-text-content th {
  @apply px-4 py-3 font-semibold text-muted-foreground text-left border-r border-border last:border-r-0;
}
.processed-text-content td {
  @apply px-4 py-3 text-left border-t border-border border-r last:border-r-0;
}
.processed-text-content tbody tr {
  @apply hover:bg-muted/50 transition-colors duration-200 ease-out;
}

/* 引用 - 只保留基础样式 */
.processed-text-content blockquote {
  @apply border-l-4 border-foreground pl-4 opacity-80 bg-muted/50 my-2 py-2;
}
